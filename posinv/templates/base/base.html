<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meter Calibration</title>
    <link rel="icon" href="{% static "dist/img/zaneco1x1.png" %}">

    <!-- Google Font: Source Sans Pro -->
    <!-- Ionicons -->
    <!-- Tempusdominus Bootstrap 4 -->
    <link rel="stylesheet" href="{% static "plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css" %}">
    <!-- iCheck -->
    <link rel="stylesheet" href="{% static "plugins/icheck-bootstrap/icheck-bootstrap.min.css" %}">
    <!-- JQVMap -->
    <link rel="stylesheet" href="{% static "plugins/jqvmap/jqvmap.min.css" %}">
    <!-- Theme style -->
    <link rel="stylesheet" href="{% static "dist/css/adminlte.min.css" %}">
    <!-- overlayScrollbars -->
    <link rel="stylesheet" href="{% static "plugins/overlayScrollbars/css/OverlayScrollbars.min.css" %}">
    <!-- Daterange picker -->
    <link rel="stylesheet" href="{% static "plugins/daterangepicker/daterangepicker.css" %}">
    <!-- summernote -->
    <link rel="stylesheet" href="{% static "plugins/summernote/summernote-bs4.min.css" %}">
    <!-- end index.html -->

    <link rel="stylesheet" href="{% static "plugins/fontawesome-pro-5.13.0-web/css/all.min.css" %}">
    <link rel="stylesheet" href="{% static "plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" %}">
    <link rel="stylesheet" href="{% static "plugins/datatables-responsive/css/responsive.bootstrap4.min.css" %}">
    <link rel="stylesheet" href="{% static "plugins/datatables-select/css/select.bootstrap4.min.css" %}">
    <link rel="stylesheet" href="{% static "plugins/datatables-buttons/css/buttons.bootstrap4.min.css" %}">
    <link rel="stylesheet" href="{% static "plugins/select2/css/select2.min.css" %}">
    <link rel="stylesheet" href="{% static "plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css" %}">

    <!-- <link rel="stylesheet" href="{% static "plugins/optionedit/jquery-editable-select.css" %}" type="text/css"> -->
    <link rel="stylesheet" href="{% static "plugins/optionedit/jquery-editable-select.min.css" %}" type="text/css">

    <link rel="stylesheet" type="text/css" href={% static "dist/css/selectdatatables/jquery.dataTables.min.css" %}">
    <link rel="stylesheet" type="text/css" href={% static "dist/css/selectdatatables/select.dataTables.min.css" %}">
    <!-- <link rel="stylesheet" type="text/css" href={% static "dist/css/selectdatatables/buttons.dataTables.min.css" %}"> -->
    <!-- <link rel="stylesheet" type="text/css" href={% static "dist/css/selectdatatables/editor.dataTables.min.css" %}">
    <link rel="stylesheet" type="text/css" href={% static "dist/css/selectdatatables/datatables.min.css" %}"> -->

    <link rel="stylesheet" href="{% static "plugins/toastr/toastr.min.css" %}">
    <link rel="stylesheet" href="{% static "plugins/toast/toast.min.css" %}">

</head>

<!-- <nav class="main-header navbar navbar-expand navbar-dark navbar-light">
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
    </ul>
</nav> -->
{% if request.user.is_authenticated %}
    {% block header %}
    {% endblock header %}

    <!-- <body class="sidebar-mini sidebar-collapse text-sm" style="height: auto;"> -->
    <body class="sidebar-mini text-sm" style="height: auto;"></body>
        <div class="wrapper">
            {% include 'base/sidebar.html' %}
            {% block content %}
            {% endblock content %}
        </div>

    </body>
{% else %}
    {% include 'base/login.html' %}
{% endif %}




<script src="{% static "plugins/jquery/jquery.min.js" %}"></script>
<script src="{% static "plugins/jquery-ui/jquery-ui.min.js" %}"></script>
<script>
    $.widget.bridge('uibutton', $.ui.button)
</script>
<script src="{% static "plugins/bootstrap/js/bootstrap.bundle.min.js" %}"></script>
<script src="{% static "plugins/chart.js/Chart.min.js" %}"></script>
<script src="{% static "plugins/sparklines/sparkline.js" %}"></script>
<script src="{% static "plugins/jqvmap/jquery.vmap.min.js" %}"></script>
<script src="{% static "plugins/jqvmap/maps/jquery.vmap.usa.js" %}"></script>
<script src="{% static "plugins/jquery-knob/jquery.knob.min.js" %}"></script>
<script src="{% static "plugins/moment/moment.min.js" %}"></script>
<script src="{% static "plugins/daterangepicker/daterangepicker.js" %}"></script>
<script src="{% static "plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js" %}"></script>
<script src="{% static "plugins/summernote/summernote-bs4.min.js" %}"></script>
<script src="{% static "plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js" %}"></script>

<script src="{% static "plugins/datatables/jquery.dataTables.min.js" %}"></script>
<script src="{% static "plugins/datatables-bs4/js/dataTables.bootstrap4.min.js" %}"></script>
<script src="{% static "plugins/datatables-responsive/js/dataTables.responsive.min.js" %}"></script>
<script src="{% static "plugins/datatables-responsive/js/responsive.bootstrap4.min.js" %}"></script>

<script src="{% static "plugins/datatables-select/js/dataTables.select.min.js" %}"></script>
<script src="{% static "plugins/datatables-select/js/select.bootstrap4.min.js" %}"></script>

<script src="{% static "plugins/datatables-buttons/js/buttons.bootstrap4.min.js" %}"></script>
<script src="{% static "plugins/datatables-buttons/js/dataTables.buttons.min.js" %}"></script>
<script src="{% static "plugins/datatables-buttons/js/dataTables.html5.min.js" %}"></script>
<script src="{% static "plugins/datatables-buttons/js/dataTables.print.min.js" %}"></script>
<script src="{% static "plugins/datatables-buttons/js/dataTables.colVis.min.js" %}"></script>

<!-- <script src="{% static "plugins/datatables-buttons/js/buttons.flash.min.js" %}"></script> -->
<!-- Toastr -->
<script src="{% static "plugins/toastr/toastr.min.js" %}"></script>
<script src="{% static "plugins/toast/toast.min.js" %}"></script>

<script src="{% static "plugins/select2/js/select2.full.min.js" %}"></script>

<!-- <script src="{% static "plugins/optionedit/jquery-editable-select.js" %}"></script> -->
<!-- <script src="{% static "plugins/optionedit/jquery-editable-select.min.js" %}"></script> -->

<script src="{% static "dist/js/adminlte.js" %}"></script>
<script src="{% static "dist/js/demo.js" %}"></script>
<script src="{% static "dist/js/pages/dashboard.js" %}"></script>

<!-- <script type="text/javascript" src="{% static "dist/css/selectdatatables/jquery.dataTables.min.js" %}"></script> -->
<!-- <script type="text/javascript" src="{% static "dist/css/selectdatatables/dataTables.select.min.js" %}"></script> -->
<!-- <script type="text/javascript" src="{% static "dist/css/selectdatatables/dataTables.buttons.min.js" %}"></script> -->
<!-- <script type="text/javascript" src="{% static "dist/css/selectdatatables/dataTables.editor.min.js" %}"></script>
<script type="text/javascript" src="{% static "dist/css/selectdatatables/tabledit.min.js" %}"></script>
<script type="text/javascript" src="{% static "dist/css/selectdatatables/dataTables.keyTable.min.js" %}"></script> -->

</html>


<script>

    $('.select2').select2();
    var rrnumber = '';

    $(document).ready(function () {

        let table_rr = $('#table_rr').DataTable({
            "searching": true,
            "processing": true,
            "stateSave": true,
            "info": true,
            "paging": true,
            "lengthChange": true,
            "autoWidth": false,
            "responsive": true,
            "columnDefs": [{
                "targets": [ 6 ],
                "className": "text-right",
            }],
            "keys": true,
            "keys": { "blurable": false },
            "select": true,
            "select": {
                "style": "os",
            },
            "serverSide": true,
            "processing": true,
            "ajax": function (data, callback, settings) {
                var sort_column_name = data.columns[data.order[0].column].data.replace(/\./g, "__");
                var direction = "";
                if (data.order[0].dir == "desc") { direction = "-" };
                $.get("{% url 'rrviews' %}", {
                    limit: data.length,
                    start: data.start,
                    filter: data.search.value,
                    order_by: direction + sort_column_name
                }, function (res) {
                    callback({
                        recordsTotal: res.length,
                        recordsFiltered: res.length,
                        data: res.objects
                    });
                });
            },
            columns: [
                { "data": "id" },
                { "data": "dateforwarded" },
                { "data": "rrnumber", "render": function (data, type, row) {
                        return '<td style="width: fit-content;"> <a href="seriallist/'+ row["id"] +'">' + data + '</a></td>'
                    }
                },
                { "data": "brand" },
                { "data": "serialnos" },
                { "data": "metertype" },
                { "data": "units" },
                { "data": "id", "render": function (data, type, row) {
                    if ('{{ request.user.is_superuser }}' == 'True') {
                    return '<center><a href="#" class="btn btn-danger btn-xs text-sm" title="Delete" onclick = "delete_meters(' + row["id"] + ')" ><i class="fal fa-trash-alt"></i><span style="font-size: 12px;"> Delete</span></a></center>'
                    } else {
                    return '<center><a href="#" class="btn btn-default btn-xs text-sm" title="Delete"><i class="fal fa-trash-alt"></i><span style="font-size: 12px;"> Delete</span></a></center>'
                    }
                    }
                },
            ]
        });
        table_rr.column(0).visible(false);
    });

    let opt_supplier = '{{ opt_supplier }}';
    let opt_rr = '{{ opt_rr }}';
    if (opt_supplier != '') $("#id_supplier").select2().val(opt_supplier).trigger('change.select2');
    if (opt_rr != '') $("#id_rrnumber").select2().val(opt_rr).trigger('change.select2');

    function meter_serial(params) {
        $('#add-serials').modal('show').draggable({ handle: ".modal-header" });
    }

    function msgalert(header, remarks, ico) {
        if (ico == 1) icon = 'fal fa-save fa-lg';
        if (ico == 2) icon = 'fas fa-pencil-alt fa-lg';
        if (ico == 3) icon = 'fal fa-trash-alt fa-lg';
        $(document).Toasts('create', {
            class: 'bg-white',
            title: '<span style="font-size: 12px;"> ' + header + ' </span>',
            subtitle: '<a href="" class="nav-link" id="">reserved!</a>',
            position: 'bottomRight',
            icon: icon,
            body: '<div class="col-md-9 row" style="width: 300px"><span style="font-size:13px;">' + remarks + '</span></div>',
            autohide: true,
            delay: 10000,
        });
};
</script>